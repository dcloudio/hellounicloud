(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/clientDB/permission-table-compound/permission-table-compound"],{"1fc9":function(e,t,n){},4882:function(e,t,n){"use strict";var o=n("1fc9"),r=n.n(o);r.a},5777:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return o}));var o={uniSegmentedControl:function(){return n.e("components/uni-segmented-control/uni-segmented-control").then(n.bind(null,"af91"))},alertCode:function(){return n.e("components/alertCode/alertCode").then(n.bind(null,"0afb"))},showCode:function(){return n.e("components/show-code/show-code").then(n.bind(null,"aa95"))},setPermission:function(){return n.e("components/set-permission/set-permission").then(n.bind(null,"ab90"))}},r=function(){var e=this,t=e.$createElement,n=(e._self._c,e.types.map((function(e){var t=e.text;return t}))),o=e.__map(e.permissionList,(function(t,n){var o=e.__get_orig(t),r=t.exclude!==e.type?e.setCode(t.code):null,u=t.exclude!==e.type&&0===n&&"create"!=e.type?Date.now():null;return{$orig:o,m0:r,g1:u}}));e._isMounted||(e.e0=function(t){e.typeIndex=t.currentIndex}),e.$mp.data=Object.assign({},{$root:{g0:n,l0:o}})},u=[]},8212:function(e,t,n){"use strict";(function(e){n("ef00");o(n("66fd"));var t=o(n("9859"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},9859:function(e,t,n){"use strict";n.r(t);var o=n("5777"),r=n("c49f");for(var u in r)"default"!==u&&function(e){n.d(t,e,(function(){return r[e]}))}(u);n("4882");var a,i=n("f0c5"),c=Object(i["a"])(r["default"],o["b"],o["c"],!1,null,"0fc8ebc1",null,!1,o["a"],a);t["default"]=c.exports},c49f:function(e,t,n){"use strict";n.r(t);var o=n("ea62"),r=n.n(o);for(var u in o)"default"!==u&&function(e){n.d(t,e,(function(){return o[e]}))}(u);t["default"]=r.a},ea62:function(e,t,n){"use strict";(function(e,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(n("a34a"));function u(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n,o,r,u,a){try{var i=e[u](a),c=i.value}catch(s){return void n(s)}i.done?t(c):Promise.resolve(c).then(o,r)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var u=e.apply(t,n);function i(e){a(u,o,r,i,c,"next",e)}function c(e){a(u,o,r,i,c,"throw",e)}i(void 0)}))}}var c=e.database(),s=function(){Promise.all([n.e("common/vendor"),n.e("components/uni-popup/uni-popup")]).then(function(){return resolve(n("dee2"))}.bind(null,n)).catch(n.oe)},l=function(){n.e("components/uni-popup/uni-popup-message").then(function(){return resolve(n("b585"))}.bind(null,n)).catch(n.oe)},d=function(){n.e("components/uni-popup/uni-popup-dialog").then(function(){return resolve(n("6f38"))}.bind(null,n)).catch(n.oe)},p=function(){n.e("components/uni-notice-bar/uni-notice-bar").then(function(){return resolve(n("f197"))}.bind(null,n)).catch(n.oe)},f=function(){n.e("components/alertCode/alertCode").then(function(){return resolve(n("0afb"))}.bind(null,n)).catch(n.oe)},h={components:{uniPopup:s,uniPopupMessage:l,uniPopupDialog:d,uniNoticeBar:p,alertCode:f},computed:{type:function(){return this.types[this.typeIndex].value},typeText:function(){return this.types[this.typeIndex].text}},data:function(){return{types:[{text:"创建",value:"create"},{text:"读取",value:"read"},{text:"更新",value:"update"},{text:"删除",value:"delete"}],typeIndex:0,permissionList:[{msg:"交集表达式",code:"doc.create_time > (now - 60000) && 'AUDITOR' in auth.role",explain:"限1分钟内的数据，“且”角色必须为审核员",exclude:"create"},{msg:"并集表达式",code:"auth.uid != null || 'add_view_count' in action",explain:"限非未登陆的游客，“或”带action",tableName:"permission-test-9"}]}},mounted:function(){o.setStorageSync("uni_id_token",""),o.setStorageSync("uni_id_token_expired","")},methods:{setCode:function(e){var t='{\n\t\t\t\t"permission":{\n\t\t\t\t\t"'.concat(this.type,'":"').concat(e,'"\n\t\t\t\t}\n\t\t\t}');return console.log(JSON.parse(t)),JSON.parse(t)},myFn:function(e){var t=this;return i(r.default.mark((function n(){var u,a,i;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:console.log("myFun"+JSON.stringify(e)),e.where=e.where||{},u=t.permissionList[e.index],a=u.tableName||"permission-test-"+(e.index+8),o.showLoading({mask:!0}),console.log("表名称："+a+"\n 条件："+JSON.stringify(e.where)),n.prev=6,n.t0=e.type,n.next="read"===n.t0?10:"create"===n.t0?17:"update"===n.t0?21:"delete"===n.t0?25:29;break;case 10:return n.next=12,c.action(e.action).collection(a).where(e.where).get();case 12:if(i=n.sent,0!=i.result.data.length){n.next=16;break}return o.showModal({title:"数据为空，请先点击创建数据",showCancel:!1}),n.abrupt("return",!1);case 16:return n.abrupt("break",31);case 17:return n.next=19,c.action(e.action).collection(a).add({text:"默认写入的数据"+Date.now()});case 19:return i=n.sent,n.abrupt("break",31);case 21:return n.next=23,c.action(e.action).collection(a).where(e.where).update({text:"更新后的数据"+Date.now()});case 23:return i=n.sent,n.abrupt("break",31);case 25:return n.next=27,c.action(e.action).collection(a).where(e.where).remove();case 27:return i=n.sent,n.abrupt("break",31);case 29:return console.log("err 未定义事件类型"),n.abrupt("break",31);case 31:n.next=38;break;case 33:return n.prev=33,n.t1=n["catch"](6),console.log("TODO handle the exception",n.t1),o.showModal({title:"错误:"+n.t1.message+","+n.t1.code,content:u.explain+"【"+t.typeText+"数据】"+(u.explain_end?u.explain_end:""),showCancel:!1}),n.abrupt("return",!1);case 38:return n.prev=38,o.hideLoading(),n.finish(38);case 41:t.$refs.alertCode.open(i.result);case 42:case"end":return n.stop()}}),n,null,[[6,33,38,41]])})))()},changePermission:function(e){console.log(e)}}};t.default=h}).call(this,n("a9ff")["default"],n("543d")["default"])}},[["8212","common/runtime","common/vendor"]]]);