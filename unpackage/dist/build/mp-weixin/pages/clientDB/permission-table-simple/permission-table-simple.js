(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/clientDB/permission-table-simple/permission-table-simple"],{"278a":function(e,n,t){"use strict";t.r(n);var o=t("9c11"),r=t.n(o);for(var a in o)"default"!==a&&function(e){t.d(n,e,(function(){return o[e]}))}(a);n["default"]=r.a},"2f25":function(e,n,t){"use strict";var o=t("829f"),r=t.n(o);r.a},"829f":function(e,n,t){},"912d":function(e,n,t){"use strict";t.d(n,"b",(function(){return r})),t.d(n,"c",(function(){return a})),t.d(n,"a",(function(){return o}));var o={uniSegmentedControl:function(){return t.e("components/uni-segmented-control/uni-segmented-control").then(t.bind(null,"af91"))},alertCode:function(){return t.e("components/alertCode/alertCode").then(t.bind(null,"0afb"))},showCode:function(){return t.e("components/show-code/show-code").then(t.bind(null,"aa95"))},setPermission:function(){return t.e("components/set-permission/set-permission").then(t.bind(null,"ab90"))}},r=function(){var e=this,n=e.$createElement,t=(e._self._c,e.types.map((function(e){var n=e.text;return n}))),o=e.__map(e.permissionList,(function(n,t){var o=e.__get_orig(n),r=n.exclude!==e.type?e.setCode(n.code):null,a=n.exclude!==e.type&&4==t&&"add"!=e.type?Date.now():null;return{$orig:o,m0:r,g1:a}}));e._isMounted||(e.e0=function(n){e.typeIndex=n.currentIndex}),e.$mp.data=Object.assign({},{$root:{g0:t,l0:o}})},a=[]},"9c11":function(e,n,t){"use strict";(function(e,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=a(t("a34a"));function a(e){return e&&e.__esModule?e:{default:e}}function i(e,n,t,o,r,a,i){try{var u=e[a](i),c=u.value}catch(s){return void t(s)}u.done?n(c):Promise.resolve(c).then(o,r)}function u(e){return function(){var n=this,t=arguments;return new Promise((function(o,r){var a=e.apply(n,t);function u(e){i(a,o,r,u,c,"next",e)}function c(e){i(a,o,r,u,c,"throw",e)}u(void 0)}))}}var c=e.database(),s=function(){Promise.all([t.e("common/vendor"),t.e("components/uni-popup/uni-popup")]).then(function(){return resolve(t("dee2"))}.bind(null,t)).catch(t.oe)},l=function(){t.e("components/uni-popup/uni-popup-message").then(function(){return resolve(t("b585"))}.bind(null,t)).catch(t.oe)},d=function(){t.e("components/uni-popup/uni-popup-dialog").then(function(){return resolve(t("6f38"))}.bind(null,t)).catch(t.oe)},p=function(){t.e("components/uni-notice-bar/uni-notice-bar").then(function(){return resolve(t("f197"))}.bind(null,t)).catch(t.oe)},f=function(){t.e("components/alertCode/alertCode").then(function(){return resolve(t("0afb"))}.bind(null,t)).catch(t.oe)},m={components:{uniPopup:s,uniPopupMessage:l,uniPopupDialog:d,uniNoticeBar:p,alertCode:f},computed:{type:function(){return this.types[this.typeIndex].value},typeText:function(){return this.types[this.typeIndex].text}},data:function(){return{lll:'"permission":{',types:[{text:"创建",value:"create"},{text:"读取",value:"read"},{text:"更新",value:"update"},{text:"删除",value:"delete"}],typeIndex:0,permissionList:[{msg:"无任何限制",code:!0,explain:"允许任何角色",explain_end:"本表"},{msg:"完全拒绝",code:!1,explain:"禁止任何角色",explain_end:"，管理员角色除外"},{msg:"需要登陆",code:'"auth.uid != null"',explain:"需要登陆后，换句话说限制：未登陆游客"},{msg:"仅限自己创建",code:'"doc.uid == auth.uid"',explain:"只能",explain_end:"自己创建的数据",exclude:"create"},{msg:"表达式限制",code:'"doc.create_time > (now - 60000)"',explain:"只能",explain_end:"1分钟内创建的数据",exclude:"create"},{msg:"限特定角色",code:"\"'AUDITOR' in auth.role\"",explain:"限审核员角色"},{msg:"读取必须带上action",code:"\"'add_view_count' in action\"",explain:"数据操作",explain_end:"请求同时必须同时附带执行一个action云函数，如未触发该action则权限验证失败"}]}},mounted:function(){o.setStorageSync("uni_id_token",""),o.setStorageSync("uni_id_token_expired","")},methods:{setCode:function(e){var n='{\n\t\t\t\t"permission":{\n\t\t\t\t\t"'.concat(this.type,'":').concat(e,"\n\t\t\t\t}\n\t\t\t}");return JSON.parse(n)},myFn:function(e){var n=this;return u(r.default.mark((function t(){var a,i,u;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("myFun"+JSON.stringify(e)),e.where=e.where||{},a=n.permissionList[e.index],i=a.tableName||"permission-test-"+(e.index+1),o.showLoading({mask:!0}),console.log("表名称："+i+"\n 条件："+JSON.stringify(e.where)),t.prev=6,t.t0=e.type,t.next="read"===t.t0?10:"create"===t.t0?17:"update"===t.t0?21:"delete"===t.t0?25:29;break;case 10:return t.next=12,c.action(e.action).collection(i).where(e.where).get();case 12:if(u=t.sent,0!=u.result.data.length){t.next=16;break}return o.showModal({title:"数据为空，请先点击创建数据",showCancel:!1}),t.abrupt("return",!1);case 16:return t.abrupt("break",31);case 17:return t.next=19,c.action(e.action).collection(i).add({text:"默认写入的数据"+Date.now()});case 19:return u=t.sent,t.abrupt("break",31);case 21:return t.next=23,c.action(e.action).collection(i).where(e.where).update({text:"更新后的数据"+Date.now()});case 23:return u=t.sent,t.abrupt("break",31);case 25:return t.next=27,c.action(e.action).collection(i).where(e.where).remove();case 27:return u=t.sent,t.abrupt("break",31);case 29:return console.log("err 未定义事件类型"),t.abrupt("break",31);case 31:t.next=38;break;case 33:return t.prev=33,t.t1=t["catch"](6),console.log("TODO handle the exception",t.t1),o.showModal({title:"错误:"+t.t1.message+","+t.t1.code,content:a.explain+"【"+n.typeText+"数据】"+(a.explain_end?a.explain_end:""),showCancel:!1}),t.abrupt("return",!1);case 38:return t.prev=38,o.hideLoading(),t.finish(38);case 41:n.$refs.alertCode.open(u.result);case 42:case"end":return t.stop()}}),t,null,[[6,33,38,41]])})))()},changePermission:function(e){console.log(e)}}};n.default=m}).call(this,t("a9ff")["default"],t("543d")["default"])},"9f9d":function(e,n,t){"use strict";t.r(n);var o=t("912d"),r=t("278a");for(var a in r)"default"!==a&&function(e){t.d(n,e,(function(){return r[e]}))}(a);t("2f25");var i,u=t("f0c5"),c=Object(u["a"])(r["default"],o["b"],o["c"],!1,null,"a03e4e52",null,!1,o["a"],i);n["default"]=c.exports},a923:function(e,n,t){"use strict";(function(e){t("ef00");o(t("66fd"));var n=o(t("9f9d"));function o(e){return e&&e.__esModule?e:{default:e}}e(n.default)}).call(this,t("543d")["createPage"])}},[["a923","common/runtime","common/vendor"]]]);